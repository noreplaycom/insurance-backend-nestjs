//See the visual ER Diagram here https://prisma-erd.simonknott.de/

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

generator client {
    provider = "prisma-client-js"
}

generator fake_data {
    provider = "prisma-generator-fake-data"
    output   = "./fake-data.ts"
}

generator nestgraphql {
    provider                              = "node node_modules/prisma-nestjs-graphql"
    output                                = "../src/@generated"
    reExport                              = Single
    fields_Validator_from                 = "class-validator"
    fields_Validator_input                = true
    requireSingleFieldsInWhereUniqueInput = true
    emitSingle                            = true
    emitCompiled                          = true
    purgeOutput                           = true
    noTypeId                              = true
}

//-----------------------------------------------------------------

model User {
    //-----------------------------scalars-------------------------
    id String @id @default(uuid())

    ///Nama Lengkap
    fullName String

    email String @unique

    emailVerifiedAt DateTime?

    password String

    profilePictureUrl String?

    /// @HideField({ output: false, input: true })
    ///Tgl.Masuk Peserta
    createdAt DateTime @default(now())

    /// @HideField({ output: false, input: true })
    updatedAt DateTime @updatedAt

    deletedAt DateTime? //implement softdelete

    //-------------------------- 1 relations --------------------------------

    role Role @relation(fields: [roleId], references: [id], onDelete: SetDefault)

    roleId Int @default(1)

    participant Participant?

    participantId Int?

    //-------------------------- m relations --------------------------------

    claimsInput Claim[]

    claimActions ClaimStatus[] @relation("statusUpdatedBy")

    announcementCreated Announcement[]

    notification Notification[]

    //claim-claim yang menunggu aksi dari user
    claimsOnWait Claim[] @relation("waitingfor")

    @@map("users")
}

model Role {
    //-------------------------- scalars --------------------------------
    id Int @id @default(autoincrement())

    /// E.g., 'superuser', 'analyst', 'group leader'
    name String

    description String?

    // ///Jika orderLevel dia adalah 9999 maka     dia adalah superuser
    // orderLevel Int @default(0)

    higherLevelThan Role? @relation("level", fields: [higherLevelThanId], references: [id])

    higherLevelThanId Int?

    roleType RoleType?

    //-------------------------- m relations --------------------------------

    rolePermissions RolePermission[]

    users User[]

    lowerLevelThan Role[] @relation("level")

    @@map("roles")
}

enum RoleType {
    SUPERUSER
    PARTICIPANT
    ADMIN
}

model RolePermission {
    id     Int  @id @default(autoincrement())
    //-------------------------- scalars --------------------------------
    roleId Int?

    //-------------------------- 1 relations --------------------------------
    role Role? @relation(fields: [roleId], references: [id])

    permission Permission
}

enum Permission {
    CREATE_CLAIM
    UPDATE_CLAIM
    UPDATE_CLAIM_STATUS
    UPDATE_STATUS_FINANCIAL
    RELEASE_CLAIM
    DELETE_CLAIM_DOCUMENT
    CREATE_CLAIM_DOCUMENT
    IMPORT_CLAIM
    EXPORT_CLAIM
    CREATE_PARTICIPANT
    UPDATE_PARTICIPANT
    IMPORT_PARTICIPANT
    EXPORT_PARTICIPANT
}

model Participant {
    //-------------------------- scalars --------------------------------

    ///Jenis Kelamin
    gender Gender

    ///Tanggal Lahir
    birthDate DateTime

    // age Int //tidak perlu disimpan ke db

    ///Nomer Kartu tanda Penduduk
    // nationalId String

    // ///Nomer kartu Keluarga
    // familyCardNumber String

    // ///Nomer NPWP
    // taxId String?

    ///Aktif/Non Aktif:	Status Kepesertaan Aktif/non aktif
    isActive Boolean

    // ///Nomer peserta (jika Pensiunan menggunakan -1, Pasangan -2, Yatim -3, 6 bulan -4)
    // participantNumber String

    //-------------------------- 1 relations --------------------------------

    ///Pensiunan,Pasangan, Yatim, Janda/duda 6 bulan
    status ParticipantStatus

    user User @relation(fields: [userId], references: [id])

    userId String @id

    ///Anggota keluarga dari
    relation Participant? @relation("ParticipantRelation", fields: [relationId], references: [userId])

    relationId String?

    bankAccount BankAccount?

    //-------------------------- m relations --------------------------------

    claims Claim[]

    employments Employment[]

    contactInfos ContactInfo[]

    programParticipations ProgramParticipation[]

    balances Account[]

    ///Anggota keluarga dari
    Participant Participant[] @relation("ParticipantRelation")

    @@map("participants")
}

enum ParticipantStatus {
    PENSIUNAN
    PASANGAN
    YATIM
    JANDADUDA6BULAN
}

enum Position {
    AMGR
    AVP
    PGD
    MGR
    SASST
    VP
    SAVP
    SMGR
    SAMGR
    ASST
}

model ContactInfo {
    //-------------------------- scalars --------------------------------

    id Int @id @default(autoincrement())

    telp String

    createdAt DateTime @default(now())

    updatedAt DateTime @updatedAt

    deletedAt DateTime?

    //-------------------------- 1 relations --------------------------------

    participant Participant @relation(fields: [participantId], references: [userId])

    participantId String

    address Address @relation(fields: [addressId], references: [id])

    addressId Int
}

///Provinsi
model Province {
    id     Int    @id @default(autoincrement())
    /// @Validator.MinLength(2)
    /// @Validator.IsNotEmpty()
    name   String @unique
    /// @HideField()   
    cities City[]
}

//Make CRUD Available
///Kota
model City {
    id         Int        @id @default(autoincrement())
    /// @Validator.MinLength(2)
    /// @Validator.IsNotEmpty()
    /// Nama Kota
    name       String
    province   Province   @relation(fields: [provinceId], references: [id])
    provinceId Int
    districts  District[]
}

//Make CRUD Available
///Kecamatan
model District {
    id           Int           @id @default(autoincrement())
    /// @Validator.MinLength(2)
    /// @Validator.IsNotEmpty()
    /// Nama Kecamatan
    name         String
    city         City          @relation(fields: [cityId], references: [id])
    cityId       Int
    subdistricts Subdistrict[]
}

///Kelurahan
model Subdistrict {
    id         Int       @id @default(autoincrement())
    ///Nama Kelurahan
    name       String
    district   District  @relation(fields: [districtId], references: [id])
    districtId Int
    /// @Validator.MinLength(3)
    /// @Validator.IsPostalCode('ID')
    /// Kode Pos
    postalCode String
    /// @HideField()
    address    Address[] @relation("SubdistrictAddress")
}

model Address {
    //-------------------------- scalars --------------------------------

    id Int @id @default(autoincrement())

    ///Alamat
    address String

    /// @Validator.IsNotEmpty()
    subdistrict   Subdistrict @relation("SubdistrictAddress", fields: [subdistrictId], references: [id])
    // @HideField({ match: 'AddressCreate*Input' })
    subdistrictId Int

    //-------------------------- scalars --------------------------------

    ContactInfo ContactInfo[]
}

model BankAccount {
    //-------------------------- scalars --------------------------------

    id Int @id @default(autoincrement())

    ///No. Rekening	Nomer Rekening Penerimaan Manfaat Pensiun
    accountNumber Float

    ///Rekening a/n.	Nama pada rekening bank
    accountName String

    //-------------------------- 1 relations --------------------------------

    participant Participant @relation(fields: [participantId], references: [userId])

    participantId String @unique
}

model Employment {
    //-------------------------- scalars --------------------------------

    id Int @id @default(autoincrement())

    //-------------------------- 1 relations --------------------------------

    ///Jenjang Jabatan terakhir
    employmentPosition Position

    participant Participant @relation(fields: [participantId], references: [userId])

    participantId String

    branch Branch @relation(fields: [branchId], references: [id])

    branchId Int

    group Group? @relation(fields: [groupId], references: [id])

    groupId Int?

    region Region? @relation(fields: [regionId], references: [id])

    regionId Int?
}

model Branch {
    //-------------------------- scalars --------------------------------

    id Int @id @default(autoincrement())

    ///Nama Cabang
    name String

    createdAt DateTime @default(now())

    updatedAt DateTime @updatedAt

    //-------------------------- m relations --------------------------------

    employment Employment[]

    claimFinancial ClaimFinancial[]
}

model Group {
    //-------------------------- scalars --------------------------------
    id Int @id @default(autoincrement())

    name String

    createdAt DateTime @default(now())

    updatedAt DateTime @updatedAt

    //-------------------------- m relations --------------------------------

    employment Employment[]
}

model Region {
    //-------------------------- scalars --------------------------------
    id Int @id @default(autoincrement())

    name String

    createdAt DateTime @default(now())

    updatedAt DateTime @updatedAt

    //-------------------------- m relations --------------------------------
    employment Employment[]
}

model Announcement {
    //-------------------------- scalars --------------------------------
    id Int @id @default(autoincrement())

    title String

    content String

    imageUrl String?

    createdAt DateTime @default(now())

    updatedAt DateTime @updatedAt

    //-------------------------- 1 relations --------------------------------

    createdBy User @relation(fields: [createdById], references: [id])

    createdById String
}

model Notification {
    //-------------------------- scalars --------------------------------

    id Int @id @default(autoincrement())

    /// @HideField({ output: false, input: true })
    /// @Validator.IsNotEmpty()
    title String

    /// @HideField({ output: false, input: true })
    subtitle String

    /// @HideField({ output: false, input: true })
    /// @Validator.IsNotEmpty()
    content String

    isRead Boolean @default(false)

    isCleared Boolean @default(false)

    /// @HideField({ output: false, input: true })
    deepLink String?

    /// @HideField({ output: false, input: true })
    fcmToken String?

    /// @HideField({ output: false, input: true })
    createdAt DateTime @default(now())

    /// @HideField({ output: false, input: true })
    updatedAt DateTime @updatedAt

    //-------------------------- 1 relations --------------------------------
    /// @HideField({ match: ['NotificationCreate*Input','NotificationUpdate*Input']})
    user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
    /// @HideField({ output: false, input: true })
    userId String
}

model ProgramParticipation {
    //-------------------------- scalars --------------------------------

    ///Nopol:	Nomer Polish
    id Int @id @default(autoincrement())

    ///No.BPJS/ASKES: Nomer kartu BPJS
    bpjsNumber String?

    ///Keterangan Non Aktif:	keterangan perihal penonaktifan
    nonActiveReason String?

    ///Tgl. Efektif: Tanggal mulai ikut program Fasilitas Kesehatan
    effectiveDate DateTime

    ///Tgl Non Aktif:	tanggal penonaktifan peserta
    nonActiveDate DateTime?

    //-------------------------- 1 relations --------------------------------

    participant Participant @relation(fields: [participantId], references: [userId])

    participantId String

    ///Dana
    funding Account @relation(fields: [fundingId], references: [id])

    ///Nomor Dana
    fundingId Int

    Program Program? @relation(fields: [programId], references: [id])

    programId Int?
}

///Reference Document: https://rebrand.ly/d6i9uem
model Program {
    //-------------------------- scalars --------------------------------

    id Int @id @default(autoincrement())

    ///Nama Program
    ///Plan	PlanType = jenis Rawat inap atau disingkat RI
    plan ApplicationType

    // ///Jenis:	Jenis Produk Bantuan
    // jenis String

    // ///Jenis RI:	Hospital Cash Plan
    // jenisRI String

    ///misal 50% dari biaya UGD/IGD, Plafon per pasangan maksimal Rp. 1.500.000 /tahun 
    maxAllowancePercentage Int?

    ///Plafon Santunan:	Plafon Santnan Harian Rawat Inap
    allowanceCeiling Float?

    ///Maksimal santunan [60] hari rawat inap/tahun/orang
    maxAllowancePerYear Float?

    ///Masa klaim [60] hari sejak keluar rumah sakit/tanggal kuitansi
    claimPeriodMax Int?

    ///Klaim ulang maksimal [60] hari sejak tanggal pemberitahuan
    reclaimPeriodMax Int?

    createdAt DateTime @default(now())

    updatedAt DateTime @updatedAt

    deletedAt DateTime?

    //-------------------------- 1 relations --------------------------------

    ///KELAS: Kelas sesuai Jenjab I=Rp.1.250.000 II=Rp.1.000.000  III= Rp.750.000 
    class Class

    //-------------------------- m relations --------------------------------

    programParticipations ProgramParticipation[]

    claims Claim[]
}

///KELAS: Kelas sesuai Jenjab I=Rp.1.250.000 II=Rp.1.000.000  III= Rp.750.000 
enum Class {
    I
    II
    III
}

model Claim {
    //-------------------------- scalars --------------------------------

    /// @HideField({ output: false, input: true })
    ///Nok:	Nomer Register Klaim
    ///Nomor Sm	nomer register Surat masuk (Klaim melalui WA/Reguler/Exception/Email)
    id String @id @default(cuid())

    //orderNumber  String //tidak perlu nomor urut

    /// @HideField({ output: false, input: true })
    ///Tklaim:	Tanggal Klaim
    createdAt DateTime @default(now())

    /// @HideField({ output: false, input: true })
    updatedAt DateTime @updatedAt

    /// @HideField({ output: false, input: true })
    deletedAt DateTime?

    //-------------------------- 1 relations --------------------------------

    ///Metode Klaim:	WA,E-mail,Reguler, Telepon
    channel ClaimChannel

    ///Stat. Admedika:	Status Admedika
    admedicaStatus AdmedicaStatus

    ///Prsh:	Perusahaan
    company String

    // ///Prsh:	Perusahaan
    // companyId Int

    participant Participant @relation(fields: [participantId], references: [userId])

    participantId String

    claimFinancials ClaimFinancial @relation(fields: [claimFinancialId], references: [id])

    claimFinancialId Int @unique

    claimProcesses ClaimProcess @relation(fields: [claimProcessId], references: [id])

    claimProcessId Int @unique

    disease Disease? @relation(fields: [diseaseId], references: [id])

    diseaseId Int?

    clinics Clinic @relation(fields: [clinicId], references: [id])

    clinicId Int

    inputedBy User? @relation(fields: [inputedById], references: [id])

    inputedById String?

    program Program @relation(fields: [programId], references: [id])

    programId Int

    waitingFor User? @relation("waitingfor", fields: [waitingForId], references: [id])

    waitingForId String?

    //-------------------------- m relations --------------------------------

    tags Tag[]

    /// @HideField({ output: true, input: true })
    claimStatuses ClaimStatus[]
}

enum ClaimChannel {
    REGULER
    WA
    EMAIL
}

model Document {
    //-------------------------- scalars --------------------------------

    ///Nodok:	Nomer Dokumen
    id String @id @default(cuid())

    ///Nama Dokumen
    name String

    ///Path:	Path file dokumen
    path String

    ///Ukuran:	Ukuran dokumen
    size Int

    ///Jumlah Cetak:	Jumlah cetak dokumen
    printCount Int

    createdAt DateTime @default(now())

    updatedAt DateTime @updatedAt
    //-------------------------- 1 relations --------------------------------

    source DocumentSource

    type DocumentType

    rejectionLetterOf ClaimStatus? @relation("rejectionLetter")

    guaranteeLetterOf ClaimStatus? @relation("guaranteeLetter")

    ///Surat transaksi
    transactionLetterOf ClaimStatus? @relation("transactionLetter")

    ///Perintah Pembukuan
    bookKeepingOrderOf ClaimStatus? @relation("bookKeepingOrder")

    claimProcess ClaimProcess? @relation(fields: [claimProcessId], references: [id])

    claimProcessId Int?
}

enum DocumentSource {
    UPLOADED
    GENERATED
}

enum DocumentType {
    INVOICE
    CLAIM_FORM
    REJECTION_LETTER
    GUARANTEE_LETTER
    RECAP
    EXPEDITION
    TRANSFER
}

model Tag {
    //-------------------------- scalars --------------------------------

    id Int @id @default(autoincrement())

    name String

    color Color

    createdAt DateTime @default(now())

    updatedAt DateTime @updatedAt

    //-------------------------- m relations --------------------------------

    Claims Claim[]
}

enum Color {
    WHITE
    BLUE
    RED
    YELLOW
    GREEN
}

enum ApplicationType {
    SANTUNAN_HARIAN_RAWAT_INAP
    BANTUAN_BIAYA_CUCI_DARAH
    BANTUAN_KURSI_RODA
    BANTUAN_WALKER
    BANTUAN_IGD_UGD
    BANTUAN_RAWAT_INAP
}

enum AdmedicaStatus {
    NON_ADMEDICA
    ADMEDICA
}

model ClaimFinancial {
    //-------------------------- scalars --------------------------------

    id Int @id @default(autoincrement())

    ///Aju:	Jumlah nominal klaim diajukan
    requestedAmount Float

    ///Bayar:	Jumlah nominal klaim dibayar
    paidAmount Float?

    ///Tolak:	Jumlah Nominal Klaim ditolak
    rejectedAmount Float?

    ///TProses Transaksi:	Tanggal Proses Transaksi
    transactionProcessDate DateTime?

    ///Transfer:	Tanggal Transfer
    transferDate DateTime?

    //-------------------------- 1 relations --------------------------------

    ///Cabang: Cabang Pembayar Pensiun
    branchPayee Branch? @relation(fields: [branchId], references: [id])

    claim Claim?

    ///Cabang: Cabang Pembayar Pensiun
    branchId Int?

    claimStatus ClaimStatus? @relation(fields: [claimStatusId], references: [id])

    claimStatusId Int? @unique
}

model ClaimProcess {
    //-------------------------- scalars --------------------------------
    id Int @id @default(autoincrement())

    ///Tmulairawat	Tanggal mulai Rawat
    startTreatment DateTime?

    ///Takhirrawat	Tanggal akhir rawat
    endTreatment DateTime?

    ///Tekspedisi	Tanggal ekspedisi
    expeditionDate DateTime?

    ///Reklaim:	Keterangan untuk klaim ulang
    reclaim String?

    ///TProses Pengajuan:	Tanggal Proses pengajuan
    processDate DateTime?

    ///Ket.Pengajuan:	Keterangan konfirmasi
    submissionNote String?

    ///Keterangan:	isi keterangan 
    description String?

    ///Ket.Tambahan	keterangan tambahan
    additionalNote String?

    //-------------------------- 1 relations --------------------------------
    claim Claim?

    ///Kwitansi, data, dll: Bukti Pembayaran/Invoice Rumah Sakit oleh Peserta
    documents Document[]
}

model ClaimStatus {
    //-------------------------- scalars --------------------------------

    id Int @id @default(autoincrement())

    description String?

    rejectionReason String?

    createdAt DateTime @default(now())

    //-------------------------- 1 relations --------------------------------

    status ClaimStatusType

    createBy User @relation("statusUpdatedBy", fields: [createById], references: [id])

    createById String

    claim Claim @relation(fields: [claimId], references: [id])

    claimId String

    ///Nomor surat tolak
    ///Tanggal surat tolak
    rejectionLetter Document? @relation("rejectionLetter", fields: [rejectionLetterId], references: [id])

    ///Nomor surat tolak
    ///Tanggal surat tolak
    rejectionLetterId String? @unique

    ///No SurJam:	Nomer Surat jaminan
    guaranteeLetter Document? @relation("guaranteeLetter", fields: [guaranteeLetterId], references: [id])

    ///No SurJam:	Nomer Surat jaminan
    //Tanggal Surjam:	Tanggal Surat Jaminan
    guaranteeLetterId String? @unique

    transactionLetter Document? @relation("transactionLetter", fields: [transactionLetterId], references: [id])

    transactionLetterId String? @unique

    //Perintah Pembukuan
    bookKeepingOrder Document? @relation("bookKeepingOrder", fields: [bookKeepingOrderId], references: [id])

    bookKeepingOrderId String? @unique

    ///apabila status paid maka berelasi ke bukti pembayaran di claimFinancial
    claimFinancial ClaimFinancial?
}

model Disease {
    //-------------------------- scalars --------------------------------
    id Int @id @default(autoincrement())

    ///KodePenyakit: kode jenis penyakit
    code String

    ///NamaPenyakit: nama penyakit
    name String

    createdAt DateTime @default(now())

    updatedAt DateTime @updatedAt

    //-------------------------- m relations --------------------------------

    claims Claim[]
}

model Clinic {
    //-------------------------- scalars --------------------------------
    id Int @id @default(autoincrement())

    code String

    name String

    createdAt DateTime @default(now())

    updatedAt DateTime @updatedAt

    //-------------------------- m relations --------------------------------

    claims Claim[]
}

model Account {
    //-------------------------- scalars --------------------------------

    //Nomer Dana
    id Int @id @default(autoincrement())

    ///Sisa Plafon:	Sisa Plafon Santunan Harian Rawat Inap
    currentBalance Float

    currentBalanceLastUpdate DateTime?

    //-------------------------- 1 relations --------------------------------

    participant Participant @relation(fields: [participantId], references: [userId])

    participantId String

    //-------------------------- m relations --------------------------------

    transactions Transaction[]

    programParticipation ProgramParticipation[]
}

model Transaction {
    //-------------------------- scalars --------------------------------
    id Int @id @default(autoincrement())

    amount Float

    transactionType TransactionType

    description String?

    createdAt DateTime @default(now())

    //-------------------------- 1 relations --------------------------------

    account Account @relation(fields: [accountId], references: [id])

    accountId Int
}

enum Gender {
    UNKNOWN
    MALE
    FEMALE
}

enum ClaimStatusType {
    DOCUMENT
    PENDING
    APPROVED
    REJECTED
    RELEASE
    PAID
    COMPLETED
    CANCELLED
    REOPEN
}

enum TransactionType {
    CREDIT
    DEBIT
}

model Backup {
    //-------------------------- scalars --------------------------------
    id Int @id @default(autoincrement())

    name String

    path String?

    isSuccessful Boolean

    type BackupType

    createdAt DateTime @default(now())
}

enum BackupType {
    MANUAL
    AUTO
}
