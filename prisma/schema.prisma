//See the visual ER Diagram here https://prisma-erd.simonknott.de/

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

generator client {
    provider = "prisma-client-js"
}

generator fake_data {
    provider = "prisma-generator-fake-data"
    output   = "./fake-data.ts"
}

generator nestgraphql {
    provider                              = "node node_modules/prisma-nestjs-graphql"
    output                                = "../src/@generated"
    reExport                              = Single
    fields_Validator_from                 = "class-validator"
    fields_Validator_input                = true
    requireSingleFieldsInWhereUniqueInput = true
    emitSingle                            = true
    emitCompiled                          = true
    purgeOutput                           = true
    noTypeId                              = true
}

//-----------------------------------------------------------------

model User {
    //-----------------------------scalars-------------------------
    id String @id @default(uuid())

    ///Nama Lengkap
    fullName String

    email String @unique

    emailVerifiedAt DateTime?

    password String

    profilePictureUrl String?

    /// @HideField({ output: false, input: true })
    ///Tgl.Masuk Peserta
    createdAt DateTime @default(now())

    /// @HideField({ output: false, input: true })
    updatedAt DateTime @updatedAt

    deletedAt DateTime? //implement softdelete

    //-------------------------- 1 relations --------------------------------

    role Role @relation(fields: [roleId], references: [id])

    roleId Int

    participant Participant?

    participantId Int?

    //-------------------------- m relations --------------------------------

    claimsInput Claim[]

    claimActions ClaimStatus[]

    announcementCreated Announcement[]

    notification Notification[]

    @@map("users")
}

model Role {
    //-------------------------- scalars --------------------------------
    id Int @id @default(autoincrement())

    /// E.g., 'superuser', 'analyst', 'group leader'
    name String

    description String?

    order Int

    higherLevelThan Role? @relation("level", fields: [higherLevelThanId], references: [id])

    higherLevelThanId Int?

    //-------------------------- m relations --------------------------------

    rolePermissions RolePermission[]

    users User[]

    lowerLevelThan Role[] @relation("level")

    @@map("roles")
}

model RolePermission {
    //-------------------------- scalars --------------------------------
    roleId Int

    //-------------------------- 1 relations --------------------------------
    role Role @relation(fields: [roleId], references: [id])

    permission Permission

    @@id([roleId, permission])
}

enum Permission {
    CREATE_CLAIM
    UPDATE_CLAIM
    UPDATE_CLAIM_STATUS
    UPDATE_STATUS_FINANCIAL
    RELEASE_CLAIM
    DELETE_CLAIM_DOCUMENT
    CREATE_CLAIM_DOCUMENT
    IMPORT_CLAIM
    EXPORT_CLAIM
    CREATE_PARTICIPANT
    UPDATE_PARTICIPANT
    IMPORT_PARTICIPANT
    EXPORT_PARTICIPANT
}

model Participant {
    //-------------------------- scalars --------------------------------

    ///Jenis Kelamin
    gender Gender

    ///Tanggal Lahir
    birthDate DateTime

    // age Int //tidak perlu disimpan ke db

    ///Nomer Kartu tanda Penduduk
    // nationalId String

    // ///Nomer kartu Keluarga
    // familyCardNumber String

    // ///Nomer NPWP
    // taxId String?

    ///Aktif/Non Aktif:	Status Kepesertaan Aktif/non aktif
    isActive Boolean

    // ///Nomer peserta (jika Pensiunan menggunakan -1, Pasangan -2, Yatim -3, 6 bulan -4)
    // participantNumber String

    //-------------------------- 1 relations --------------------------------

    ///Pensiunan,Pasangan, Yatim, Janda/duda 6 bulan
    status ParticipantStatus

    user User @relation(fields: [userId], references: [id])

    userId String @id

    ///Anggota keluarga dari
    relation Participant? @relation("ParticipantRelation", fields: [relationId], references: [userId])

    relationId String?

    bankAccount BankAccount?

    bankAccountId Int

    //-------------------------- m relations --------------------------------

    claims Claim[]

    employments Employment[]

    contactInfos ContactInfo[]

    programParticipations ProgramParticipation[]

    balances Account[]

    ///Anggota keluarga dari
    Participant Participant[] @relation("ParticipantRelation")

    @@map("participants")
}

enum ParticipantStatus {
    PENSIUNAN
    PASANGAN
    YATIM
    JANDADUDA6BULAN
}

enum Position {
    AMGR
    AVP
    PGD
    MGR
    SASST
    VP
    SAVP
    SMGR
    SAMGR
    ASST
}

model ContactInfo {
    //-------------------------- scalars --------------------------------

    id Int @id @default(autoincrement())

    telp String

    createdAt DateTime @default(now())

    updatedAt DateTime @updatedAt

    deletedAt DateTime?

    //-------------------------- 1 relations --------------------------------

    participant Participant @relation(fields: [participantId], references: [userId])

    participantId String

    address Address @relation(fields: [addressId], references: [id])

    addressId Int
}

model Address {
    //-------------------------- scalars --------------------------------

    id Int @id @default(autoincrement())

    ///Alamat
    address String

    ///Kota
    city City @relation(fields: [cityId], references: [id])

    ///Kota
    cityId Int

    ///Kode Pos
    postalCode String

    //-------------------------- scalars --------------------------------

    ContactInfo ContactInfo[]
}

model City {
    //-------------------------- scalars --------------------------------

    id Int @id @default(autoincrement())

    ///Nama Kota
    name String

    createdAt DateTime @default(now())

    updatedAt DateTime @updatedAt

    //-------------------------- m relations --------------------------------

    address Address[]
}

model BankAccount {
    //-------------------------- scalars --------------------------------

    id Int @id @default(autoincrement())

    ///No. Rekening	Nomer Rekening Penerimaan Manfaat Pensiun
    accountNumber Float

    ///Rekening a/n.	Nama pada rekening bank
    accountName String

    //-------------------------- 1 relations --------------------------------

    participant Participant @relation(fields: [participantId], references: [userId])

    participantId String @unique
}

model Employment {
    //-------------------------- scalars --------------------------------

    id Int @id @default(autoincrement())

    //-------------------------- 1 relations --------------------------------

    ///Jenjang Jabatan terakhir
    employmentPosition Position

    participant Participant @relation(fields: [participantId], references: [userId])

    participantId String

    branch Branch @relation(fields: [branchId], references: [id])

    branchId Int

    group Group? @relation(fields: [groupId], references: [id])

    groupId Int

    region Region? @relation(fields: [regionId], references: [id])

    regionId Int
}

model Branch {
    //-------------------------- scalars --------------------------------

    id Int @id @default(autoincrement())

    ///Nama Cabang
    name String

    createdAt DateTime @default(now())

    updatedAt DateTime @updatedAt

    //-------------------------- m relations --------------------------------

    employment Employment[]

    claimFinancial ClaimFinancial[]
}

model Group {
    //-------------------------- scalars --------------------------------
    id Int @id @default(autoincrement())

    name String

    createdAt DateTime @default(now())

    updatedAt DateTime @updatedAt

    //-------------------------- m relations --------------------------------

    employment Employment[]
}

model Region {
    //-------------------------- scalars --------------------------------
    id Int @id @default(autoincrement())

    name String

    createdAt DateTime @default(now())

    updatedAt DateTime @updatedAt

    //-------------------------- m relations --------------------------------
    employment Employment[]
}

model Announcement {
    //-------------------------- scalars --------------------------------
    id Int @id @default(autoincrement())

    title String

    content String

    imageUrl String?

    createdAt DateTime @default(now())

    updatedAt DateTime @updatedAt

    //-------------------------- 1 relations --------------------------------

    createdBy User @relation(fields: [createdById], references: [id])

    createdById String
}

model Notification {
    //-------------------------- scalars --------------------------------

    id Int @id @default(autoincrement())

    /// @Validator.IsNotEmpty()
    title String

    subtitle String

    /// @Validator.IsNotEmpty()
    content String

    createdAt DateTime @default(now())

    isRead Boolean @default(false)

    isCleared Boolean @default(false)

    deepLink String?

    fcmToken String?

    //-------------------------- 1 relations --------------------------------

    user User @relation(fields: [userId], references: [id], onDelete: Cascade)

    userId String
}

model ProgramParticipation {
    //-------------------------- scalars --------------------------------

    ///Nopol:	Nomer Polish
    id Int @id @default(autoincrement())

    ///No.BPJS/ASKES: Nomer kartu BPJS
    bpjsNumber String?

    ///Keterangan Non Aktif:	keterangan perihal penonaktifan
    nonActiveReason String?

    ///Tgl. Efektif: Tanggal mulai ikut program Fasilitas Kesehatan
    effectiveDate DateTime

    ///Tgl Non Aktif:	tanggal penonaktifan peserta
    nonActiveDate DateTime?

    //-------------------------- 1 relations --------------------------------

    participant Participant @relation(fields: [participantId], references: [userId])

    participantId String

    ///Dana
    funding Account @relation(fields: [fundingId], references: [id])

    ///Nomor Dana
    fundingId Int

    Program Program? @relation(fields: [programId], references: [id])

    programId Int?
}

model Program {
    //-------------------------- scalars --------------------------------

    id Int @id @default(autoincrement())

    ///Nama Program
    ///Plan	PlanType = jenis Rawat inap atau disingkat RI
    plan ApplicationType

    createdAt DateTime @default(now())

    updatedAt DateTime @updatedAt

    deletedAt DateTime?

    ///Plafon Santunan:	Plafon Santnan Harian Rawat Inap
    allowanceCeiling Float

    //-------------------------- 1 relations --------------------------------

    ///KELAS: Kelas sesuai Jenjab I=Rp.1.250.000 II=Rp.1.000.000  III= Rp.750.000 
    class Class

    ///Maksimal biaya perawatan 
    maxAllowance Float

    //-------------------------- m relations --------------------------------

    programParticipations ProgramParticipation[]

    claimType ClaimType[]
}

///KELAS: Kelas sesuai Jenjab I=Rp.1.250.000 II=Rp.1.000.000  III= Rp.750.000 
enum Class {
    I
    II
    III
}

model Claim {
    //-------------------------- scalars --------------------------------

    ///Nok:	Nomer Register Klaim
    ///Nomor Sm	nomer register Surat masuk (Klaim melalui WA/Reguler/Exception/Email)
    id String @id @default(cuid())

    //orderNumber  String //tidak perlu nomor urut

    ///Tklaim:	Tanggal Klaim
    createdAt DateTime @default(now())

    updatedAt DateTime @updatedAt

    deletedAt DateTime?

    //-------------------------- 1 relations --------------------------------

    ///Metode Klaim:	WA,E-mail,Reguler, Telepon
    channel ClaimChannel

    ///Stat. Admedika:	Status Admedika
    admedicaStatus AdmedicaStatus

    ///Prsh:	Perusahaan
    company Company @relation(fields: [companyId], references: [id])

    ///Prsh:	Perusahaan
    companyId Int

    participant Participant @relation(fields: [participantId], references: [userId])

    participantId String

    claimFinancials ClaimFinancial @relation(fields: [claimFinancialId], references: [id])

    claimFinancialId Int @unique

    claimProcesses ClaimProcess @relation(fields: [claimProcessId], references: [id])

    claimProcessId Int @unique

    disease Disease? @relation(fields: [diseaseId], references: [id])

    diseaseId Int?

    clinics Clinic @relation(fields: [clinicId], references: [id])

    clinicId Int

    inputedBy User? @relation(fields: [inputedById], references: [id])

    inputedById String?

    claimTypes ClaimType @relation(fields: [claimTypeId], references: [id])

    claimTypeId Int @unique

    //-------------------------- m relations --------------------------------

    tags Tag[]

    claimStatuses ClaimStatus[]
}

enum ClaimChannel {
    REGULER
    WA
    EMAIL
}

model Document {
    //-------------------------- scalars --------------------------------

    ///Nodok:	Nomer Dokumen
    id String @id @default(cuid())

    ///Nama Dokumen
    name String

    ///Path:	Path file dokumen
    path String

    ///Ukuran:	Ukuran dokumen
    size Int

    ///Jumlah Cetak:	Jumlah cetak dokumen
    printCount Int

    createdAt DateTime @default(now())

    updatedAt DateTime @updatedAt
    //-------------------------- 1 relations --------------------------------

    source DocumentSource

    type DocumentType

    rejectionLetterOf ClaimStatus? @relation("rejectionLetter")

    guaranteeLetterOf ClaimStatus? @relation("guaranteeLetter")

    ///Surat transaksi
    transactionLetterOf ClaimStatus? @relation("transactionLetter")

    ///Perintah Pembukuan
    bookKeepingOrderOf ClaimStatus? @relation("bookKeepingOrder")

    claimProcess ClaimProcess? @relation(fields: [claimProcessId], references: [id])

    claimProcessId Int?
}

enum DocumentSource {
    UPLOADED
    GENERATED
}

enum DocumentType {
    INVOICE
    CLAIM_FORM
    REJECTION_LETTER
    GUARANTEE_LETTER
    RECAP
    EXPEDITION
    TRANSFER
}

model Tag {
    //-------------------------- scalars --------------------------------

    id Int @id @default(autoincrement())

    name String

    color Color

    createdAt DateTime @default(now())

    updatedAt DateTime @updatedAt

    //-------------------------- m relations --------------------------------

    Claims Claim[]
}

enum Color {
    WHITE
    BLUE
    RED
    YELLOW
    GREEN
}

model Company {
    //-------------------------- scalars --------------------------------

    id Int @id @default(autoincrement())

    name String

    //-------------------------- m relations --------------------------------

    claims Claim[]

    createdAt DateTime @default(now())

    updatedAt DateTime @updatedAt
}

model ClaimType {
    //-------------------------- scalars --------------------------------
    id Int @id @default(autoincrement())

    ///Jenis:	Jenis Produk Bantuan
    jenis String

    ///Jenis RI:	Hospital Cash Plan
    jenisRI String

    ///Plan	Plan = jenis Rawat inap atau disingkat RI
    plan String

    //-------------------------- 1 relations --------------------------------

    program Program @relation(fields: [programId], references: [id])

    programId Int

    //-------------------------- m relations --------------------------------

    claims Claim?

    claimId Int @unique
}

enum ApplicationType {
    SANTUNAN_HARIAN_RAWAT_INAP
    BANTUAN_BIAYA_CUCI_DARAH
    BANTUAN_KURSI_RODA
    BANTUAN_WALKER
    BANTUAN_IGD_UGD
    BANTUAN_RAWAT_INAP
}

enum AdmedicaStatus {
    NON_ADMEDICA
    ADMEDICA
}

model ClaimFinancial {
    //-------------------------- scalars --------------------------------

    id Int @id @default(autoincrement())

    ///Aju:	Jumlah nominal klaim diajukan
    requestedAmount Float

    ///Bayar:	Jumlah nominal klaim dibayar
    paidAmount Float?

    ///Tolak:	Jumlah Nominal Klaim ditolak
    rejectedAmount Float?

    ///TProses Transaksi:	Tanggal Proses Transaksi
    transactionProcessDate DateTime?

    ///Transfer:	Tanggal Transfer
    transferDate DateTime?

    //-------------------------- 1 relations --------------------------------

    ///Cabang: Cabang Pembayar Pensiun
    branchPayee Branch @relation(fields: [branchId], references: [id])

    claim Claim?

    claimId String @unique

    ///Cabang: Cabang Pembayar Pensiun
    branchId Int

    claimStatus ClaimStatus @relation(fields: [claimStatusId], references: [id])

    claimStatusId Int @unique
}

model ClaimProcess {
    //-------------------------- scalars --------------------------------
    id Int @id @default(autoincrement())

    ///Tmulairawat	Tanggal mulai Rawat
    startTreatment DateTime?

    ///Takhirrawat	Tanggal akhir rawat
    endTreatment DateTime?

    ///Tekspedisi	Tanggal ekspedisi
    expeditionDate DateTime?

    ///Reklaim:	Keterangan untuk klaim ulang
    reclaim String?

    ///TProses Pengajuan:	Tanggal Proses pengajuan
    processDate DateTime?

    ///Ket.Pengajuan:	Keterangan konfirmasi
    submissionNote String

    ///Keterangan:	isi keterangan 
    description String

    ///Ket.Tambahan	keterangan tambahan
    additionalNote String

    //-------------------------- 1 relations --------------------------------
    claim Claim?

    claimId String @unique

    ///Kwitansi, data, dll: Bukti Pembayaran/Invoice Rumah Sakit oleh Peserta
    documents Document[]
}

model ClaimStatus {
    //-------------------------- scalars --------------------------------

    id Int @id @default(autoincrement())

    description String?

    rejectionReason String?

    createdAt DateTime @default(now())

    //-------------------------- 1 relations --------------------------------

    status ClaimStatusType

    createBy User @relation(fields: [createById], references: [id])

    createById String

    claim Claim @relation(fields: [claimId], references: [id])

    claimId String

    ///Nomor surat tolak
    ///Tanggal surat tolak
    rejectionLetter Document? @relation("rejectionLetter", fields: [rejectionLetterId], references: [id])

    ///Nomor surat tolak
    ///Tanggal surat tolak
    rejectionLetterId String? @unique

    ///No SurJam:	Nomer Surat jaminan
    guaranteeLetter Document? @relation("guaranteeLetter", fields: [guaranteeLetterId], references: [id])

    ///No SurJam:	Nomer Surat jaminan
    //Tanggal Surjam:	Tanggal Surat Jaminan
    guaranteeLetterId String? @unique

    transactionLetter Document? @relation("transactionLetter", fields: [transactionLetterId], references: [id])

    transactionLetterId String? @unique

    //Perintah Pembukuan
    bookKeepingOrder Document? @relation("bookKeepingOrder", fields: [bookKeepingOrderId], references: [id])

    bookKeepingOrderId String? @unique

    claimFinancial ClaimFinancial?
}

model Disease {
    //-------------------------- scalars --------------------------------
    id Int @id @default(autoincrement())

    ///KodePenyakit: kode jenis penyakit
    code String

    ///NamaPenyakit: nama penyakit
    name String

    createdAt DateTime @default(now())

    updatedAt DateTime @updatedAt

    //-------------------------- 1 relations --------------------------------

    // group DiseaseGroup @relation(fields: [groupId], references: [id])

    // groupId Int @unique

    //-------------------------- m relations --------------------------------

    claims Claim[]
}

// model DiseaseGroup {
//     //-------------------------- scalars --------------------------------
//     id Int @id @default(autoincrement())

//     name String

//     createdAt DateTime @default(now())

//     updatedAt DateTime @updatedAt

//     //-------------------------- 1 relations --------------------------------

//     DiseaseCluster DiseaseCluster @relation(fields: [diseaseClusterId], references: [id])

//     diseaseClusterId Int

//     //-------------------------- m relations --------------------------------

//     disease Disease[]
// }

// model DiseaseCluster {
//     //-------------------------- scalars --------------------------------
//     id Int @id @default(autoincrement())

//     name String

//     createdAt DateTime @default(now())

//     updatedAt DateTime @updatedAt

//     //-------------------------- m relations --------------------------------

//     diseaseGroups DiseaseGroup[]
// }

model Clinic {
    //-------------------------- scalars --------------------------------
    id Int @id @default(autoincrement())

    code String

    name String

    createdAt DateTime @default(now())

    updatedAt DateTime @updatedAt

    //-------------------------- m relations --------------------------------

    claims Claim[]
}

model Account {
    //-------------------------- scalars --------------------------------

    //Nomer Dana
    id Int @id @default(autoincrement())

    ///Sisa Plafon:	Sisa Plafon Santunan Harian Rawat Inap
    currentBalance Float

    currentBalanceLastUpdate DateTime?

    //-------------------------- 1 relations --------------------------------

    participant Participant @relation(fields: [participantId], references: [userId])

    participantId String

    //-------------------------- m relations --------------------------------

    transactions Transaction[]

    programParticipation ProgramParticipation[]
}

model Transaction {
    //-------------------------- scalars --------------------------------
    id Int @id @default(autoincrement())

    amount Float

    transactionType TransactionType

    description String?

    createdAt DateTime @default(now())

    //-------------------------- 1 relations --------------------------------

    account Account @relation(fields: [accountId], references: [id])

    accountId Int
}

enum Gender {
    UNKNOWN
    MALE
    FEMALE
}

enum ClaimStatusType {
    DOCUMENT
    PENDING
    APPROVED
    REJECTED
    RELEASE
    PAID
    COMPLETED
    CANCELLED
    REOPEN
}

enum TransactionType {
    CREDIT
    DEBIT
}
